<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Metrics - Data Dunkers</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2%;
        }
    </style>
</head>
<body>

    <img src="https://github.com/Data-Dunkers/lessons/blob/main/images/top-banner.jpg?raw=true" alt="Data Dunkers Banner" style="width:100%; max-width:1200px;">

    <h2>Basketball Metrics: Efficiency & True Shooting</h2>
    
    <p>
        In this lesson, we move beyond basic stats like Points Per Game (PPG) to understand how efficient players really are. 
        We will explore two key advanced metrics: <strong>Efficiency (EFF)</strong>, which gives a holistic view of a player's contribution, 
        and <strong>True Shooting Percentage (TS%)</strong>, which accurately measures shooting performance by accounting for 3-pointers and free throws.
    </p>

    <iframe src="visualizations/metrics_scatter.html" width="100%" height="600px" style="border:none;"></iframe>

    <p>
        <strong>How to read this chart:</strong> 
        The X-axis shows Points Per Game (Volume), and the Y-axis shows True Shooting % (Efficiency). 
        Top-right players are superstarsâ€”high volume and high efficiency. 
        Players above the green dashed line are elite shooters.
    </p>

    <footer>
      <h3>Reflection Questions</h3>
      <p class="questions" id="questions"></p>
      <p style="text-align: center">
        <button
          onclick="copyAnswers()"
          style="padding: 10px 20px; margin-top: 10px"
        >
          Copy Answers
        </button>
      </p>
      <p id="gitpullParagraph"></p>
      <p style="text-align: center">
        <a href="index.html">home</a>
      </p>
      <img
        src="https://github.com/Data-Dunkers/lessons/blob/main/images/bottom-banner.jpg?raw=true"
        alt="Data Dunkers Bottom Banner"
        style="width: 50%; height: auto; display: block; margin: 0 auto"
      />
    </footer>

    <script>
        const questions = [
            "Why is True Shooting % (TS%) a fairer way to compare a center (who mostly dunks) and a guard (who shoots 3s)?",
            "The Efficiency formula is: (PTS + REB + AST + STL + BLK) - (Missed FG + Missed FT + TO). What is one major flaw with this stat?",
            "If a player scores 30 points but takes 30 shots to do it, would they have a high or low TS%?"
        ];
        const githubUrl =
        "https://github.com/Data-Dunkers/student/blob/main/activities/basketball-metrics.ipynb";

        function gitpullLinks(githubUrl) {
            var colabUrl =
            "https://colab.research.google.com/github/" +
            githubUrl.split("github.com/")[1];
            var res = githubUrl.split("/");
            var site = res[2];
            var user = res[3];
            var repo = res[4];
            var treeBlob = res[5];
            var branch = res[6];
            var callystoUrl =
            "https://hub.callysto.ca/jupyter/hub/user-redirect/git-pull?repo=";
            if (site == "github.com") {
            if (treeBlob) {
                var subPath = githubUrl.substring(
                githubUrl.indexOf(branch) + branch.length + 1,
                );
                callystoUrl +=
                encodeURIComponent("https://github.com/" + user + "/") +
                repo +
                "&branch=" +
                branch +
                "&subPath=" +
                subPath +
                "&depth=1";
            } else {
                callystoUrl += githubUrl;
            }
            }
            var parag = `<p>Check out the <a href="${githubUrl}">notebook</a> that generated this activity in <a href="${colabUrl}"> Colab</a> or the <a href="${callystoUrl}">Callysto Hub</a>.</p>`;
            return parag;
        }

        // insert the gitpull links
        try {
            document.getElementById("gitpullParagraph").innerHTML =
            gitpullLinks(githubUrl);
        } catch (error) {
            console.error("Error:", error);
        }

        // add the questions
        questions.forEach((question, index) => {
            const questionHTML = `<label for="question${index + 1}">${index + 1}. ${question}</label><br>
                            <input type="text" style="width:80%; padding:5px; margin:10px 0;" id="question${index + 1}"><br>`;
            document
            .getElementById("questions")
            .insertAdjacentHTML("beforeend", questionHTML);
        });

        const fileName = window.location.pathname.split("/").pop().split(".")[0];

        const savedAnswers = JSON.parse(
            localStorage.getItem(fileName + "Answers"),
        );
        if (savedAnswers) {
            questions.forEach((_, index) => {
            const input = document.getElementById(`question${index + 1}`);
            if (input && savedAnswers[`question${index + 1}`]) {
                input.value = savedAnswers[`question${index + 1}`];
            }
            });
        }

        function saveAnswers() {
            const answers = {};
            questions.forEach((_, index) => {
            answers[`question${index + 1}`] = document.getElementById(
                `question${index + 1}`,
            ).value;
            });
            localStorage.setItem(fileName + "Answers", JSON.stringify(answers));
            console.log("Answers saved.");
        }

        function debounce(fn, delay) {
            let timerId;
            return (...args) => {
            clearTimeout(timerId);
            timerId = setTimeout(() => fn(...args), delay);
            };
        }

        const saveAnswersDebounced = debounce(saveAnswers, 200);
        document
            .getElementById("questions")
            .addEventListener("input", (event) => {
            if (event.target.matches('input[type="text"]')) {
                saveAnswersDebounced();
            }
            });

        function copyAnswers() {
            const answerText = questions
            .map((questionText, index) => {
                const answer = document.getElementById(
                `question${index + 1}`,
                ).value;
                return `${index + 1}. ${questionText}\nAnswer: ${answer}\n`;
            })
            .join("\n");

            navigator.clipboard.writeText(answerText).then(
            () => {
                alert("Answers have been copied to your clipboard");
            },
            () => {
                alert("Failed to copy answers");
            },
            );
        }
    </script>
</body>
</html>
