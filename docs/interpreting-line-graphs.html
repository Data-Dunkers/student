<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Data Dunkers Visualizations - Interpreting Line Graphs</title>
  <style>
    body {
      font-family: sans-serif;
      margin-left: 2%;
      margin-right: 2%;
    }
    label {
      font-weight: bold;
    }
  </style>
</head>

<body>
  <img src="https://github.com/Data-Dunkers/lessons/blob/main/images/top-banner.jpg?raw=true" alt="Data Dunkers Banner"
    style="width:50%; height:auto; display:block; margin:0 auto;">
  <h2>Interpreting Line Graphs</h2>
  <p class="paragraph">Line graphs are designed to show how data changes over time. In statistics, we call this a <b>trend</b>. This visualization compares the scoring averages (Points Per Game) of WNBA legends <b>Diana Taurasi</b> and <b>DeWanna Bonner</b> over their careers.</p>

  <div id="visualization-container">
    <iframe src="visualizations/wnba_career_trends.html"
      style="width:100%; height:800px; border:none;"></iframe>
  </div>

  <p class="paragraph">Use the chart above to explore. Hover over points to see stats, or click names in the legend to toggle lines. You can see how the lines connect the dots to show the "zig-zag" path of their individual seasons.</p>

  <footer>
    <h3>Critical Thinking Questions</h3>
    <p class="questions" id="questions"></p>
    <p style="text-align: center;"><button onclick="copyAnswers()" style="padding:10px 20px; margin-top:10px;">Copy
        Answers</button></p>
    <p id="gitpullParagraph"></p>
    <p style="text-align:center;"><a href="index.html">home</a> | <a href="data-sources.html">next</a></p>
    <img src="https://github.com/Data-Dunkers/lessons/blob/main/images/bottom-banner.jpg?raw=true"
      alt="Data Dunkers Bottom Banner" style="width:50%; height:auto; display:block; margin:0 auto;">
  </footer>

  <script>
    const questions = [
      "Looking at Diana Taurasi's line, can you identify a multi-year period where her scoring was at its peak (a cluster)?",
      "Find a specific year for either player that could be considered an 'outlier.' Why did you pick that year?",
      "If you were a manager looking at these trends, how would you describe the difference between a 'peak' period and an 'outlier'?"
    ];

    const githubUrl = "https://github.com/Data-Dunkers/student/blob/main/activities/interpreting-line-graphs.ipynb";

    function gitpullLinks(githubUrl) {
      var colabUrl = "https://colab.research.google.com/github/" + githubUrl.split("github.com/")[1];
      var res = githubUrl.split("/");
      var site = res[2];
      var user = res[3];
      var repo = res[4];
      var treeBlob = res[5];
      var branch = res[6];
      var callystoUrl = "https://hub.callysto.ca/jupyter/hub/user-redirect/git-pull?repo=";
      if (site == "github.com") {
        if (treeBlob) {
          var subPath = githubUrl.substring(githubUrl.indexOf(branch) + branch.length + 1);
          callystoUrl += encodeURIComponent("https://github.com/" + user + "/") + repo + "&branch=" + branch + "&subPath=" + subPath + "&depth=1";
        } else {
          callystoUrl += githubUrl;
        }
      }
      var parag = `<p>Check out the <a href="${githubUrl}">notebook</a> that generated this visualization in <a href="${colabUrl}"> Colab</a> or the <a href="${callystoUrl}">Callysto Hub</a>.</p>`;
      return parag;
    }

    // insert the gitpull links
    try {
      document.getElementById('gitpullParagraph').innerHTML = gitpullLinks(githubUrl);
    } catch (error) {
      console.error('Error:', error);
    }

    // add the questions
    questions.forEach((question, index) => {
      const questionHTML = `<label for="question${index + 1}">${index + 1}. ${question}</label><br>
                          <input type="text" style="width:80%; padding:5px; margin:10px 0;" id="question${index + 1}"><br>`;
      document.getElementById('questions').insertAdjacentHTML('beforeend', questionHTML);
    });

    const fileName = window.location.pathname.split('/').pop().split('.')[0];

    const savedAnswers = JSON.parse(localStorage.getItem(fileName + 'Answers'));
    if (savedAnswers) {
      questions.forEach((_, index) => {
        const input = document.getElementById(`question${index + 1}`);
        if (input && savedAnswers[`question${index + 1}`]) {
          input.value = savedAnswers[`question${index + 1}`];
        }
      });
    }

    function saveAnswers() {
      const answers = {};
      questions.forEach((_, index) => {
        const input = document.getElementById(`question${index + 1}`);
        if (input) {
            answers[`question${index + 1}`] = input.value;
        }
      });
      localStorage.setItem(fileName + 'Answers', JSON.stringify(answers));
      console.log('Answers saved.');
    }

    function debounce(fn, delay) {
      let timerId;
      return (...args) => {
        clearTimeout(timerId);
        timerId = setTimeout(() => fn(...args), delay);
      };
    }

    const saveAnswersDebounced = debounce(saveAnswers, 200);
    document.getElementById('questions').addEventListener('input', (event) => {
      if (event.target.matches('input[type="text"]')) {
        saveAnswersDebounced();
      }
    });

    function copyAnswers() {
      const answerText = questions.map((questionText, index) => {
        const answer = document.getElementById(`question${index + 1}`).value;
        return `${index + 1}. ${questionText}\nAnswer: ${answer}\n`;
      }).join('\n');

      navigator.clipboard.writeText(answerText).then(() => {
        alert('Answers have been copied to your clipboard');
      }, () => {
        alert('Failed to copy answers');
      });
    }
  </script>
</body>

</html>
