<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="RSD 5.0.3490">
  <title>Data Dunkers - Synthetic Data</title>
  <style>
    body {
      font-family: sans-serif;
      margin-left: 2%;
      margin-right: 2%;
    }
  </style>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>

<body>
  <img src="https://github.com/Data-Dunkers/lessons/blob/main/images/top-banner.jpg?raw=true" alt="Data Dunkers Banner"
    style="width:50%; height:auto; display:block; margin:0 auto;">
  <h2>Synthetic Data</h2>
  <p class="paragraph"><a href="https://en.wikipedia.org/wiki/Synthetic_data">Synthetic data</a> is data that is
    generated by a computer program. We will create data about some hypothetical basketball players based on the
    following assumptions:</p>
  <ul>
    <li>heights are normally distributed with a mean of 180 cm and a standard deviation of 10 cm</li>
    <li>wingspans are 5 cm longer than heights, with a standard deviation of 5 cm</li>
    <li>reaction times are normally distributed with a mean of 180 cm and a standard deviation of 10 ms</li>
    <li>free throw probabilities are based on reaction times</li>
  </ul>

  <label for="number_of_players">Number of Players:</label>
  <input type="text" style="width:5%; padding:5px; margin:10px 0;" id="number_of_players" value="50">
  <button id="run-button" style="padding:5px 10px; margin-left:10px; display:none;">Generate New Data</button>
  <div id="python-output"><i>Loading script...</i></div>
  <div id="visualization-container"></div>

  <py-config>
    packages = ["numpy", "pandas", "plotly", "statsmodels"]
  </py-config>

  <script type="py">
    import numpy as np
    import pandas as pd
    import plotly.express as px
    from pyscript import display
    from js import document
    from pyodide.ffi import create_proxy

    def generate_and_display(event=None):
        # Read the value from the input box
        try:
            number_of_players = int(document.getElementById("number_of_players").value)
        except ValueError:
            number_of_players = 50

        height = np.round(np.random.normal(loc=180, scale=10, size=number_of_players)).astype(int)
        wingspan = np.round(height + np.random.normal(loc=5, scale=5, size=number_of_players)).astype(int)
        reaction_time = np.round(np.clip(np.random.normal(loc=180, scale=10, size=number_of_players), a_min=180, a_max=400)).astype(int)
        ft_probability = np.clip(1-(reaction_time-180)/200, a_min=0.3, a_max=0.9)
        free_throws = np.random.binomial(n=5, p=ft_probability)

        df = pd.DataFrame({"Height (cm)": height, "Wingspan (cm)": wingspan, "Reaction Time (ms)": reaction_time, "Free Throws (out of 5)": free_throws})
        
        # Clear previous output
        document.getElementById("python-output").innerHTML = ""
        document.getElementById("visualization-container").innerHTML = ""
        display(df, target="python-output")
        fig = px.scatter(df, x="Height (cm)", y="Wingspan (cm)", title="Wingspan vs Height", trendline="ols")
        display(fig, target="visualization-container")

    # Create a proxy for the callback
    generate_proxy = create_proxy(generate_and_display)
    
    # Assign to window so JS can call it
    from js import window
    window.generateData = generate_proxy
    
    # Show the button now that everything is loaded
    document.getElementById("run-button").style.display = "inline-block"
    document.getElementById("footer").style.display = "block"
    
    # Clear loading message
    document.getElementById("python-output").innerHTML = ""
  </script>

  <script>
    document.getElementById("run-button").addEventListener("click", () => {
      document.getElementById("python-output").innerHTML = "<b>Generating data...</b>";
      document.getElementById("visualization-container").innerHTML = "";
      // Use setTimeout to allow the UI to update before Python blocks
      setTimeout(() => {
        if (window.generateData) {
          window.generateData();
        }
      }, 50);
    });
  </script>


  <p class="paragraph">
  </p>

  <footer id="footer" style="display:none;">
    <h3>Questions</h3>
    <p class="questions" id="questions"></p>
    <p style="text-align: center;"><button onclick="copyAnswers()" style="padding:10px 20px; margin-top:10px;">Copy
        Answers</button></p>
    <p id="gitpullParagraph"></p>
    <p style="text-align:center;"><a href="index.html">home</a></p>
    <img src="https://github.com/Data-Dunkers/lessons/blob/main/images/bottom-banner.jpg?raw=true"
      alt="Data Dunkers Bottom Banner" style="width:50%; height:auto; display:block; margin:0 auto;">
  </footer>

  <script>
    const questions = [
      'What do we mean by "synthetic data"? What are some purposes of synthetic data?',
      "Even though we generated random data, why do the values still look realistic?",
      "We made some assumptions when generating the data. Are they valid?"
    ];

    const githubUrl = "https://github.com/Data-Dunkers/student/blob/main/activities/synthetic-data.ipynb";

    function gitpullLinks(githubUrl) {
      var colabUrl = "https://colab.research.google.com/github/" + githubUrl.split("github.com/")[1];
      var res = githubUrl.split("/");
      var site = res[2];
      var user = res[3];
      var repo = res[4];
      var treeBlob = res[5];
      var branch = res[6];
      var callystoUrl = "https://hub.callysto.ca/jupyter/hub/user-redirect/git-pull?repo=";
      if (site == "github.com") {
        if (treeBlob) {
          var subPath = githubUrl.substring(githubUrl.indexOf(branch) + branch.length + 1);
          callystoUrl += encodeURIComponent("https://github.com/" + user + "/") + repo + "&branch=" + branch + "&subPath=" + subPath + "&depth=1";
        } else {
          callystoUrl += githubUrl;
        }
      }
      var parag = `<p>Check out the <a href="${githubUrl}">notebook</a> that generated this visualization in <a href="${colabUrl}"> Colab</a> or the <a href="${callystoUrl}">Callysto Hub</a>.</p>`;
      return parag;
    }

    // insert the gitpull links
    try {
      document.getElementById('gitpullParagraph').innerHTML = gitpullLinks(githubUrl);
    } catch (error) {
      console.error('Error:', error);
    }

    // add the questions
    questions.forEach((question, index) => {
      const questionHTML = `<label for="question${index + 1}">${index + 1}. ${question}</label><br>
                          <input type="text" style="width:80%; padding:5px; margin:10px 0;" id="question${index + 1}"><br>`;
      document.getElementById('questions').insertAdjacentHTML('beforeend', questionHTML);
    });

    const fileName = window.location.pathname.split('/').pop().split('.')[0];

    const savedAnswers = JSON.parse(localStorage.getItem(fileName + 'Answers'));
    if (savedAnswers) {
      questions.forEach((_, index) => {
        const input = document.getElementById(`question${index + 1}`);
        if (input && savedAnswers[`question${index + 1}`]) {
          input.value = savedAnswers[`question${index + 1}`];
        }
      });
    }

    function saveAnswers() {
      const answers = {};
      questions.forEach((_, index) => {
        answers[`question${index + 1}`] = document.getElementById(`question${index + 1}`).value;
      });
      localStorage.setItem(fileName + 'Answers', JSON.stringify(answers));
      console.log('Answers saved.');
    }

    function debounce(fn, delay) {
      let timerId;
      return (...args) => {
        clearTimeout(timerId);
        timerId = setTimeout(() => fn(...args), delay);
      };
    }

    const saveAnswersDebounced = debounce(saveAnswers, 200);
    document.getElementById('questions').addEventListener('input', (event) => {
      if (event.target.matches('input[type="text"]')) {
        saveAnswersDebounced();
      }
    });

    function copyAnswers() {
      const answerText = questions.map((questionText, index) => {
        const answer = document.getElementById(`question${index + 1}`).value;
        return `${index + 1}. ${questionText}\nAnswer: ${answer}\n`;
      }).join('\n');

      navigator.clipboard.writeText(answerText).then(() => {
        alert('Answers have been copied to your clipboard');
      }, () => {
        alert('Failed to copy answers');
      });
    }


  </script>
</body>

</html>